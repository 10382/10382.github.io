{"title":"Mdict转Mac词典小记","slug":"Mdict转Mac词典小记","date":"2019-05-26T13:02:35.000Z","updated":"2019-05-26T14:19:07.210Z","comments":true,"excerpt":"","content":"<blockquote>\n<p>题图画师: <a href=\"https://www.pixiv.net/member.php?id=12296581\" target=\"_blank\" rel=\"noopener\">shnva☯</a> 原图: <a href=\"https://www.pixiv.net/member_illust.php?mode=medium&amp;illust_id=67297385\" target=\"_blank\" rel=\"noopener\">出处</a></p>\n</blockquote>\n<h2 id=\"环境配置\"><a href=\"#环境配置\" class=\"headerlink\" title=\"环境配置\"></a>环境配置</h2><ul>\n<li>字典格式转换工具：<a href=\"https://github.com/ilius/pyglossary/releases\" target=\"_blank\" rel=\"noopener\"><code>pyglossary</code></a></li>\n<li>读取 MDX 格式依赖包：<code>python-lzo</code> <ul>\n<li>安装：<code>pip3 install python-lzo</code></li>\n<li>遇到问题：<code>lzomodule.c:35:10: fatal error: &#39;lzo/lzo1x.h&#39; file not found</code></li>\n<li>解决方案：<code>brew install lzo</code></li>\n</ul>\n</li>\n<li>写入 AppleDict 格式依赖包：<code>lxml</code> / <code>beautifulsoup4</code> / <code>html5lib</code> </li>\n<li>安装：<code>pip3 install lxml beautifulsoup4 html5lib</code>  </li>\n<li>苹果字典开发套件：<code>Dictionary Development Kit</code><ul>\n<li>从 <a href=\"https://developer.apple.com/download/more/\" target=\"_blank\" rel=\"noopener\">苹果开发者工具下载页面</a> 下载包含 <code>Dictionary Development Kit</code> 的镜像 <code>Additional Tools for Xcode 10.2</code> (版本号可能不同)</li>\n<li>安装：将镜像中 Utilities 文件夹中的 <code>Dictionary Development Kit</code> 丢到合适的位置 (比如：<code>/Applications/Utilities/</code> 下)</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"词典转换\"><a href=\"#词典转换\" class=\"headerlink\" title=\"词典转换\"></a>词典转换</h2><blockquote>\n<p>本例中转换词典来源为 <a href=\"https://www.pdawiki.com/forum/forum.php?mod=viewthread&amp;tid=15143\" target=\"_blank\" rel=\"noopener\">Langheping-古汉语常用字字典(第4版)(王力编繁体字本+繁简词头索引)</a> 和 <a href=\"https://www.pdawiki.com/forum/forum.php?mod=viewthread&amp;tid=17072\" target=\"_blank\" rel=\"noopener\">tsiank-汉语大词典图像版</a>，感谢他们制作精良的 Mdict 词典，才能让我们更好的学习与使用。</p>\n</blockquote>\n<p>在终端中调用转换脚本</p>\n<ul>\n<li><code>--read-options=resPath=</code> 表示将词典中的资源文件 (图片 / 音频等) 提取到哪个文件夹 (本例为 <code>OtherResources</code>)</li>\n<li><code>--write-format=</code> 表示转换成的格式 (本例为 <code>AppleDict</code>)</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 ~/Clone/pyglossary/pyglossary.pyw --read-options=resPath=OtherResources --write-format=AppleDict 古汉语常用字字典2016mobi.mdx acud2016-apple</span><br></pre></td></tr></table></figure>\n<h3 id=\"编译\"><a href=\"#编译\" class=\"headerlink\" title=\"编译\"></a>编译</h3><p>修改词典配置文件</p>\n<ol>\n<li>修改转换出来的词典文件夹 (本例为 <code>acud2016-apple</code> ) 中的 <code>Makefile</code> 文件<ul>\n<li>修改 <code>DICT_BUILD_TOOL_DIR</code> 为上文丢到的位置 (如: <code>/Applications/Utilities/Dictionary Development Kit</code>)</li>\n</ul>\n</li>\n<li>修改转换出来的词典文件夹中的 <code>.plist</code> 文件<ul>\n<li><code>CFBundleDisplayName</code>：词典显示名称 (本例为 <code>古汉语常用字字典(第4版)(繁简索引)</code> )</li>\n<li><code>CFBundleIdentifier</code>：词典 ID (本例为 <code>acud2016</code> )</li>\n<li><code>CFBundleName</code>：Mac词典程序工具栏下显示的标签名 (本例为 <code>Ancient Chinese (Wangli)</code> )</li>\n</ul>\n</li>\n<li>如果 <code>.mdx</code> 文件同级路径下有 <code>.css</code> 文件的话，将其内容复制到转换出来的词典文件夹中的 <code>.css</code> 文件 (本例为 <code>acud2016-apple.css</code> ) 中</li>\n<li>修改转换出来的词典文件夹里的 <code>.xml</code> 文件中的资源链接<ul>\n<li>将 <code>src=&quot;/</code> 替换为 <code>src=&quot;</code> ( 绝对路径改相对路径 )</li>\n</ul>\n</li>\n</ol>\n<p>修改完成后在终端使用 <code>make</code> 命令编译词典</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ae01.alicdn.com/kf/HTB1sxwNak5E3KVjSZFC762uzXXau.png\" alt=\"词典编译\"></p>\n<p>编译成功后会在词典路径的 <code>object</code> 文件夹下生成对应的 <code>.dictionary</code> 文件 (本例为 <code>acud2016-apple.dictionary</code> )</p>\n<h2 id=\"词典安装\"><a href=\"#词典安装\" class=\"headerlink\" title=\"词典安装\"></a>词典安装</h2><ol>\n<li>将生成的 <code>.dictionary</code> 丢到 <code>/Users/你的用户名/Library/Dictionaries</code> 文件夹中 (或打开词典应用，菜单栏选择「文件」-&gt;「打开词典文件夹」再复制进去)</li>\n<li><p>在词典应用中的菜单栏选择「词典」-&gt;「偏好设置」，然后勾选☑️该词典即可</p>\n<p><img src=\"https://ae01.alicdn.com/kf/HTB1FbAOalWD3KVjSZKP761p7FXaZ.png\" alt=\"词典勾选\"></p>\n</li>\n</ol>\n<p>如果此处安装完成后可以正常使用的，那么可以不用往后看了。</p>\n<h2 id=\"词典修复\"><a href=\"#词典修复\" class=\"headerlink\" title=\"词典修复\"></a>词典修复</h2><h3 id=\"链接跳转\"><a href=\"#链接跳转\" class=\"headerlink\" title=\"链接跳转\"></a>链接跳转</h3><p>然而我的词典出现了无法正常跳转的问题，因为这里涉及到一个 <code>x-dictionary:URI</code> 格式的问题，我们需要将类似</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"x-dictionary:d:entry://㼐\"</span>&gt;</span>㼐<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>的 url 链接转换为</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"x-dictionary:d:㼐:acud2016\"</span>&gt;</span>㼐<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>其中 <code>acud2016</code> 为上文中在 <code>.plist</code> 文件中的 <code>CFBundleIdentifier</code> 项的值。</p>\n<p>通过 <a href>Sublime Text</a> 的正则表达式搜索并替换 (或通过写代码替换)</p>\n<p><img src=\"https://ae01.alicdn.com/kf/HTB1BxwNak5E3KVjSZFC762uzXXar.png\" alt=\"正则替换\"></p>\n<h3 id=\"图片格式跳转\"><a href=\"#图片格式跳转\" class=\"headerlink\" title=\"图片格式跳转\"></a>图片格式跳转</h3><p>有的词典是将词条重定位到该页图片地址的，但它的跳转形式是这样的</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@@@LINK=DCD130006</span><br></pre></td></tr></table></figure>\n<p>这并不符合 Mac 词典的跳转，所以我们需要将其替换为</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"x-dictionary:d:DCD130006:acud2016\"</span>&gt;</span>DCD130006<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ae01.alicdn.com/kf/HTB1IjoSalCw3KVjSZFl763JkFXaR.png\" alt=\"正则替换LINK\"></p>\n<h3 id=\"修复暗色模式背景颜色\"><a href=\"#修复暗色模式背景颜色\" class=\"headerlink\" title=\"修复暗色模式背景颜色\"></a>修复暗色模式背景颜色</h3><p>通过上述方法转换出来的词典在暗色模式下背景是白色的，但有些文字就是白色的，导致无法看到具体内容。</p>\n<p>在已经转换好的词典文件 <code>.dictionary</code> 上右键，点击「显示包内容」，进入词典文件夹内。点击「Contents」文件夹，编辑 <code>DefaultStyle.css</code> ，添加以下几句话</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"keyword\">media</span> (prefers-dark-interface)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"selector-tag\">html</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">-apple-color-filter</span>: <span class=\"built_in\">apple-invert-lightness</span>();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"selector-tag\">a</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">-apple-color-filter</span>: none;</span><br><span class=\"line\">\t\t<span class=\"attribute\">color</span>: -webkit-link;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"selector-tag\">img</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">filter</span>: <span class=\"built_in\">invert</span>(100%);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如果觉得白色图片因此颜色太黑了的话，可以调整 <code>invert()</code> 里的值，<strong>80%</strong> 时会和背景颜色相同，自己按需调整即可。</p>\n<h3 id=\"其他问题\"><a href=\"#其他问题\" class=\"headerlink\" title=\"其他问题\"></a>其他问题</h3><p>若遇到其他问题，可以参考 <a href=\"https://kaihao.io/2018/mdict-to-macos-dictionary/\" target=\"_blank\" rel=\"noopener\">Mdict to macOS Dictionary转换笔记</a></p>\n<h2 id=\"效果预览\"><a href=\"#效果预览\" class=\"headerlink\" title=\"效果预览\"></a>效果预览</h2><p><a href=\"https://www.pdawiki.com/forum/forum.php?mod=viewthread&amp;tid=15143\" target=\"_blank\" rel=\"noopener\">Langheping-古汉语常用字字典(第4版)(王力编繁体字本+繁简词头索引)</a> </p>\n<p><img src=\"https://ae01.alicdn.com/kf/HTB1UzoSalCw3KVjSZFl763JkFXau.png\" alt=\"古汉语常用字字典\"></p>\n<p><a href=\"https://www.pdawiki.com/forum/forum.php?mod=viewthread&amp;tid=17072\" target=\"_blank\" rel=\"noopener\">tsiank-汉语大词典图像版</a> ( <code>invert(80%)</code>的效果 )</p>\n<p><img src=\"https://ae01.alicdn.com/kf/HTB1sYEOalWD3KVjSZKP761p7FXaz.png\" alt=\"汉语大词典图像版\"></p>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"https://kaihao.io/2018/mdict-to-macos-dictionary/\" target=\"_blank\" rel=\"noopener\">Mdict to macOS Dictionary转换笔记</a></li>\n<li><a href=\"https://github.com/ilius/pyglossary\" target=\"_blank\" rel=\"noopener\">ilius/pyglossary</a></li>\n<li><a href=\"https://www.pdawiki.com/forum/forum.php?mod=viewthread&amp;tid=13014\" target=\"_blank\" rel=\"noopener\">MAC OSX词典转换笔记</a></li>\n<li><a href=\"https://www.douban.com/note/529238204/?type=like\" target=\"_blank\" rel=\"noopener\">How to Convert Mdict to Mac OS X dictionary</a></li>\n<li><a href=\"https://eclecticlight.co/2018/10/04/make-mojave-custom-dictionaries-work-better/\" target=\"_blank\" rel=\"noopener\">Make Mojave custom dictionaries work better</a></li>\n</ul>\n","thumbnail":"https://ae01.alicdn.com/kf/HTB1nFwVafWG3KVjSZFg762TspXay.png","categories":[{"name":"Mac","path":"api/categories/Mac.json"}],"tags":[{"name":"Dictionary","path":"api/tags/Dictionary.json"}]}